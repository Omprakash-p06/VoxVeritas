---
phase: 7
plan: 1
wave: 1
---

# Plan 7.1: Bug Fixing & Server Stability

## Objective
Resolve all known bugs identified in the RESEARCH.md, ensuring the application starts correctly and API endpoints are still reachable after the `StaticFiles` mount.

## Context
- .gsd/phases/7/RESEARCH.md
- src/main.py
- scripts/

## Tasks

<task type="auto">
  <name>Create `run_server.ps1` Convenience Script</name>
  <files>scripts/run_server.ps1</files>
  <action>
    - Create a `scripts/run_server.ps1` PowerShell script.
    - It should: (1) Set `PYTHONPATH`, (2) activate the venv, (3) start `uvicorn src.main:app` using the venv's Python.
    - This eliminates the `ModuleNotFoundError` from Bug 1.
  </action>
  <verify>Run `.\scripts\run_server.ps1` and confirm the server starts with `Application startup complete.` in the logs.</verify>
  <done>Server launches reliably without PATH issues.</done>
</task>

<task type="auto">
  <name>Audit StaticFiles Mount Order</name>
  <files>src/main.py</files>
  <action>
    - Verify that `app.mount("/", StaticFiles(...))` is the LAST statement in `create_app()`, placed AFTER all `include_router()` calls.
    - If not, reorder accordingly.
    - Test that `/ask`, `/transcribe`, `/synthesize`, and `/ask_voice` endpoints still respond with HTTP 200 (not 404) when the server is live.
  </action>
  <verify>
    ```powershell
    # With server running:
    (Invoke-WebRequest -Uri "http://localhost:8000/health" -Method GET).StatusCode  # Should be 200
    ```
  </verify>
  <done>API routes are not shadowed by the StaticFiles mount.</done>
</task>

<task type="auto">
  <name>Run Full Pytest Suite</name>
  <files>tests/</files>
  <action>
    - Run all test files sequentially using pytest:
      ```powershell
      $env:PYTHONPATH="c:\Users\OM Prakash\Documents\VoxVeritas"
      .\venv\Scripts\python -m pytest tests/ -v --ignore=tests/fixtures
      ```
    - Fix any failing tests encountered.
  </action>
  <verify>All tests return PASSED status. Show the final pytest summary line.</verify>
  <done>Complete test suite passes without errors.</done>
</task>

## Success Criteria
- [ ] `run_server.ps1` successfully launches the FastAPI server.
- [ ] All API endpoints remain reachable after the StaticFiles mount.
- [ ] No pytest failures remain.
