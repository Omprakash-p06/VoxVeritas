---
phase: 9
plan: 2
wave: 1
---

# Plan 9.2: Chat Endpoints & Document Deletion

## Objective
Update the `QA` and `Document` REST APIs. Add a normal chat mode feature to bypass document constraints and implement the `DELETE` endpoint to allow users to remove their uploaded files.

## Context
- .gsd/SPEC.md
- src/api/qa.py
- src/services/rag_service.py
- src/api/document.py
- src/services/vector_store.py

## Tasks

<task type="auto">
  <name>Implement Normal Chat Mode in QA Endpoint</name>
  <files>
    src/api/qa.py
    src/services/rag_service.py
    tests/test_qa_api.py
  </files>
  <action>
    - Add an optional `mode: str = "rag"` field to the `QAQuery` pydantic schema.
    - Accept `mode` in `POST /ask`.
    - In `rag_service.py`, if `mode == "chat"`:
      - Call `self.llm_service.generate_response(query, model_type="chat")`.
      - Skip the ChromaDB retrieval entirely.
      - Return the answer without the "No documents found" fallback guard.
  </action>
  <verify>curl -X POST http://localhost:8000/ask -d '{"query":"hello", "mode":"chat"}'</verify>
  <done>LLM greets back naturally when in chat mode without triggering the safety guard.</done>
</task>

<task type="auto">
  <name>Implement Document Deletion Endpoint</name>
  <files>
    src/api/document.py
    src/services/vector_store.py
  </files>
  <action>
    - Update `vector_store.py` to add `delete_document(collection, doc_id: str)`. Use `collection.delete(where={"doc_id": doc_id})`.
    - Implement `DELETE /documents/{doc_id}` in `document.py`.
    - Call the vector store deletion.
    - Remove the document from the `.data/uploads/` directory on disk.
    - Return `{"status": "deleted", "doc_id": doc_id}`.
  </action>
  <verify>pytest -v tests/test_document.py (or via curl)</verify>
  <done>User can successfully delete an ingested document from ChromaDB and the disk.</done>
</task>

## Success Criteria
- [ ] Users can query `/ask` with `mode="chat"` to get unrestricted LLM access.
- [ ] Users can `DELETE /documents/{doc_id}` to fully wipe an uploaded file.
